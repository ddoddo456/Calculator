<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='UTF-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <!-- font-family: 'Lato', sans-serif; -->
</head>

<body>
  <div id='wrap'>
    <hgroup>
      <h2></h2>
      <h1></h1>
    </hgroup>
    <table>
      <tr>
        <td class='cancel purple' colspan="2">CE</td>
        <td class='operator purple'>%</td>
        <td class='operator purple'>/</td>
      </tr>
      <tr>
        <td class='number'>7</td>
        <td class='number'>8</td>
        <td class='number'>9</td>
        <td class='operator purple'>*</td>
      </tr>
      <tr>
        <td class='number'>4</td>
        <td class='number'>5</td>
        <td class='number'>6</td>
        <td class='operator purple'>-</td>
      </tr>
      <tr>
        <td class='number'>1</td>
        <td class='number'>2</td>
        <td class='number'>3</td>
        <td class='operator purple'>+</td>
      </tr>
      <tr>
        <td class='zero'>0</td>
        <td class='dot'>.</td>
        <td class='equal purple' colspan="2">=</td>
      </tr>
    </table>
  </div>
</body>
<script>
  const h1 = document.querySelector('h1');
  const h2 = document.querySelector('h2');
  let input = '';
  let array = [];
  let count = {
    plus: 0,
    minus: 0,
    multiply: 0,
    divide: 0,
    percentage: 0,
  }
  function getArray() {
    let temp = '';
    for (let i = 0; i < input.length; i++) {
      if (input[i] == '+' || input[i] == '-' || input[i] == '*' || input[i] == '/' || input[i] == '%') {
        array.push(temp);
        array.push(input[i]);
        temp = '';
      } else {
        temp += input[i];
      }
      i == input.length - 1 ? array.push(temp) : null;
    }
  }
  function isEmpty(value) {
    if (value == "" || value == null || value == undefined || (value != null && typeof value == "object" && !Object.keys(value).length)) {
      return true
    }
    else {
      return false
    }
  }
  function calculate(param) {
    let x, y, pos;
    function plus() {
      for (let i = 0; i < count.plus; i++) {
        pos = param.indexOf('+');
        x = Number(param[pos - 1]);
        y = Number(param[pos + 1]);
        param.splice(pos - 1, 3);
        param.splice(pos - 1, 0, x + y);
      }
      count.plus = 0;
    }
    function minus() {
      for (let i = 0; i < count.minus; i++) {
        pos = param.indexOf('-');
        x = Number(param[pos - 1]);
        y = Number(param[pos + 1]);
        param.splice(pos - 1, 3);
        param.splice(pos - 1, 0, x - y);
      }
      count.minus = 0;
    }
    function multiply() {
      for (let i = 0; i < count.multiply; i++) {
        pos = param.indexOf('*');
        x = Number(param[pos - 1]);
        y = Number(param[pos + 1]);
        param.splice(pos - 1, 3);
        param.splice(pos - 1, 0, x * y);
      }
      count.multiply = 0;
    }
    function divide() {
      for (let i = 0; i < count.divide; i++) {
        pos = param.indexOf('/');
        x = Number(param[pos - 1]);
        y = Number(param[pos + 1]);
        param.splice(pos - 1, 3);
        param.splice(pos - 1, 0, x / y);
      }
      count.divide = 0;
    }
    function percentage() {
      for (let i = 0; i < count.percentage; i++) {
        pos = param.indexOf('%');
        x = Number(param[pos - 1]);
        y = 0;
        param.splice(pos - 1, 2);
        param.splice(pos - 1, 0, x / 100);
      }
      count.percentage = 0;
    }
    percentage();
    multiply();
    divide();
    minus();
    plus();
    return array[0];
  }
  document.querySelectorAll('.number').forEach(function (e) {
    e.addEventListener('click', function () {
      input += this.innerText;
      h1.innerText = input;
    });
  });
  document.querySelector('.zero').addEventListener('click', function () {
    if (input.match(/\./gi) == null) {
      if (input.match(/\b0/gi) == null) {
        input += this.innerText;
        h1.innerText = input;
      }
    } else {
      input += this.innerText;
      h1.innerText = input;
    }
  });
  document.querySelector('.cancel').addEventListener('click', function () {
    input = input.slice(0, -1);
    h1.innerText = input;
  });
  document.querySelector('.dot').addEventListener('click', function () {
    let i = input.length;
    let temp = '';
    while (i > 0) {
      i--;
      if (input[i] == '+' || input[i] == '-' || input[i] == '*' || input[i] == '/' || input[i] == '%') { break; }
      temp += input[i];
    }
    if (isEmpty(temp.match(/\./gi)) && !input == '' && !temp == '') {
      input += this.innerText;
      h1.innerText = input;
    }
  });
  document.querySelector('.equal').addEventListener('click', function () {
    let lastString = h1.innerText[h1.innerText.length - 1];
    if (!isEmpty(lastString.match(/[0-9%]/gi))) {
      getArray();
      h1.innerText = calculate(array);
      h2.innerText = input;
      input = String(calculate(array));
      array = [];
    }
  });
  document.querySelectorAll('.operator').forEach(function (e) {
    e.addEventListener('click', function () {
      let lastString = h1.innerText[h1.innerText.length - 1];
      if (!isEmpty(lastString.match(/[0-9%]/gi))) {
        input += this.innerText;
        h1.innerText += e.innerText;
        e.innerText == '+' ? count.plus++ : null;
        e.innerText == '-' ? count.minus++ : null;
        e.innerText == '*' ? count.multiply++ : null;
        e.innerText == '/' ? count.divide++ : null;
        e.innerText == '%' ? count.percentage++ : null;
      }
    });
  });
</script>

</html>